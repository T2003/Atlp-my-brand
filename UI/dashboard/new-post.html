<!DOCTYPE html>

<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <title> D-Designer | Dashboard </title>
    <link rel="stylesheet" href="style.css">
 
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
   </head>
<body>
  <div class="sidebar">
    <div class="logo-details">
        <i class='bx bx-user-circle' title="D-Designer"></i>
      <span class="logo_name">D-Designer</span>
    </div>
      <ul class="nav-links">
        <li>
          <a href="admin.html" class="active">
            <i class='bx bx-grid-alt' ></i>
            <span class="links_name">Dashboard</span>
          </a>
        </li>
       
        <li>
          <a href="view-post.html">
            <i class='bx bx-show-alt' ></i>
            <span class="links_name">View post</span>
          </a>
        </li>
        <li>
          <a href="message.html">
            <i class='bx bx-message-detail' ></i>
            <span class="links_name">Messages</span>
          </a>
        </li>
        
        <li class="log_out">
          <a href="#">
            <i class='bx bx-log-out'></i>
            <span class="links_name">Log out</span>
          </a>
        </li>
      </ul>
  </div>
  <section class="home-section">
    <nav>
      <div class="sidebar-button">
        <i class='bx bx-menu sidebarBtn'></i>
        <span class="dashboard"></span>
      </div>
      <div class="">
        <h2>Post On Blog</h2>
      </div>
      <div class="profile-details">
        <img src="assets/img/e.jpg" alt="">
        <span class="admin_name">Daniel T</span>
       
        <a href="#" id="logoutBtn"><i class='bx bx-log-out' title="logout" style="cursor: pointer;"></i></a>
      </div>
    </nav>

    <div class="home-content">
      
      <div class="sales-boxes">
        <div class="recent-sales box">
          <div class="article-form">
            
          <div class="title"><h2>Make New Post</h2></div><br>
          <form action="" id="blogform" enctype="multipart/form-data">
            <div class="content">
              <div class="article-form">
                
                  <h4>Title</h4>
                  <input type="text" id="title" name="title" placeholder="  Article Title" required><br><br>
                  <h4>Cover Image</h4>
                  <input type="file" id="file" name="image"><br><br>
                  <h4>Body</h4>
                  <textarea name="" id="content" cols="30" rows="10"></textarea>
                  
                
              </div>
            </div><br>
              <input type="submit" value="New" id="submitBtn" />
           </form>
         </div>
        </div>
        <div class="top-sales box">
            <div class="title"><h3>Tags</h3></div>
            <ul class="top-sales-details">
              <li>
              <a href="#">
                
                <span class="product">- Tech</span>
              </a>
            </li>
            <li>
              <a href="#">
                <span class="product">- Business</span>
              </a>
            
            </li>
            <li>
              <a href="#">
                <span class="product">- Life Experience</span>
              </a>
            </li>
            <li>
                <a href="#">
                  <span class="product">- Football</span>
                </a>
              </li>
            
            </ul>
          </div>
      </div>
    </div>
  </section> -->

  <script>
   let sidebar = document.querySelector(".sidebar");
let sidebarBtn = document.querySelector(".sidebarBtn");
sidebarBtn.onclick = function() {
  sidebar.classList.toggle("active");
  if(sidebar.classList.contains("active")){
  sidebarBtn.classList.replace("bx-menu" ,"bx-menu-alt-right");
}else
  sidebarBtn.classList.replace("bx-menu-alt-right", "bx-menu");
}
 </script>
 <script src="./javascript.js"></script>
 <script>
   const user = JSON.parse(localStorage.getItem('loginedUser'))
   

   if (localStorage.getItem("updateArticle")) {
     let article = JSON.parse(localStorage.getItem("updateArticle"));

     document.getElementById("cover").style.display = "none";
     document.getElementById("submitBtn").value = "UPDATE";

     document.getElementById("title").value = article.title;
     document.getElementById("body").value = article.content;
     // document.getElementById("tag").value = article.tag;
     // var articleId = article.id

     document
       .getElementById("AddArticleForm")
       .addEventListener("submit", (event) => {
         event.preventDefault();
console.log("update")
         const title = document.getElementById("title").value;
         const content = CKEDITOR.instances.body.getData();
         const tag = document.getElementById("tag").value;

         var myHeaders = new Headers();
         myHeaders.append("Authorization", `Bearer ${user.token}`);
         myHeaders.append("Content-Type", "application/json");

         var raw = JSON.stringify({
           "title": title,
           "content": content
         });

         var requestOptions = {
           method: 'PATCH',
           headers: myHeaders,
           body: raw,
           redirect: 'follow'
         };

         fetch(`https://my-brand-app-api.herokuapp.com/api/articles/update/${id}`, requestOptions)
           .then(response => response.text())
           .then(result => console.log(result))
           .catch(error => console.log('error', error));


       });
   } else {

     

     document.getElementById("file").required = ""

     document.getElementById("blogform").addEventListener("submit", (event) => {
         event.preventDefault();
         console.log('here')
         const title =document.getElementById("title").value;
         const body = document.getElementById("content").value;
        //  const image = document.getElementById("file");
         var myHeaders = new Headers();
         
myHeaders.append("Authorization", "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjYyNmZkMjM0NTJkNTNjMzZlNmNlMzYxNyIsImlhdCI6MTY1MjE1OTY2MiwiZXhwIjoxNjU0NzUxNjYyfQ.iJuMr7Oe0gJtc3PVMbiwOl4yd0peL4M3Kr8tNSYy8m8");
myHeaders.append("Content-Type", "application/json");

var raw = JSON.stringify({
  "title": title,
  "content":body
});

var requestOptions = {
  method: 'POST',
  headers: myHeaders,
  body: raw,
  redirect: 'follow'
};

fetch("https://my-brand-app-v1.herokuapp.com/api/articles/add", requestOptions)
  .then(response => response.json())
  .then(result => {console.log(result)
   window.open("./view-post.html", "_self");
})

  .catch(error => console.log('error', error));

        
        //  console.log(file)
       });
   }
 </script>
</body>
</html>
